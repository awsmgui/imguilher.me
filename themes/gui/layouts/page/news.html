{{ define "main" }}
<div class="list-page">
    <h1 class="list-title">{{ .Title }}</h1>

    <div id="password-gate">
        <p class="password-prompt">Esta página é protegida. Por favor, insira a senha para continuar:</p>
        <form id="password-form" class="password-form">
            <input type="password" id="password-input" class="password-input" autofocus>
            <button type="submit" class="password-submit">Acessar</button>
        </form>
        <p id="error-message" class="error-message" style="display:none;">Senha incorreta.</p>
    </div>

    <div id="secret-content" style="display:none;">
        <div id="feed-container">
            <p class="loading-message">Carregando notícias...</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const passwordGate = document.getElementById('password-gate');
        const passwordForm = document.getElementById('password-form');
        const passwordInput = document.getElementById('password-input');
        const errorMessage = document.getElementById('error-message');
        const secretContent = document.getElementById('secret-content');

        // MUDE SUA SENHA SECRETA AQUI
        const secretPassword = "sua_senha_super_secreta";

        passwordForm.addEventListener('submit', function(event) {
            event.preventDefault();
            if (passwordInput.value === secretPassword) {
                passwordGate.style.display = 'none';
                secretContent.style.display = 'block';
                fetchFeeds();
            } else {
                errorMessage.style.display = 'block';
                passwordInput.value = '';
            }
        });

        const feedContainer = document.getElementById("feed-container");
        // MUDE OS FEEDS RSS AQUI
        const rssFeeds = [
            "https://g1.globo.com/rss/g1/tecnologia/",
            "https://rss.tecmundo.com.br/feed"
        ];

        async function fetchFeeds() {
            let allItems = [];
            const proxyUrl = "https://api.rss2json.com/v1/api.json?rss_url=";
            for (const url of rssFeeds) {
                try {
                    const response = await fetch(proxyUrl + encodeURIComponent(url));
                    const data = await response.json();
                    if (data.status === 'ok') {
                        data.items.forEach(item => item.feedTitle = data.feed.title);
                        allItems.push(...data.items);
                    }
                } catch (error) { console.error("Falha ao buscar o feed:", url, error); }
            }
            allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
            displayItems(allItems);
        }

        function displayItems(items) {
            if (items.length === 0) {
                feedContainer.innerHTML = "<p>Não foi possível carregar as notícias no momento.</p>";
                return;
            }
            let html = "";
            items.forEach(item => {
                const pubDate = new Date(item.pubDate).toLocaleDateString('pt-BR');
                const description = new DOMParser().parseFromString(item.description, 'text/html').body.textContent || "";
                html += `<article class="feed-item"><h3 class="feed-item-title"><a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.title}</a></h3><p class="feed-item-meta">Por <strong>${item.author || item.feedTitle}</strong> em ${pubDate}</p><p class="feed-item-description">${description.substring(0, 150)}...</p></article>`;
            });
            feedContainer.innerHTML = html;
        }
    });
</script>
{{ end }}
